<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Meine Einkaufsliste</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root {
            --primary-color: #2E7D32; 
            --primary-light: #4CAF50;
            --bg-color: #f4f4f9;
            --card-bg: #ffffff;
            --text-color: #222;
            --gray-text: #666;
            --border-color: #ddd;
            --danger-color: #e53935;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding-bottom: 100px; 
            overscroll-behavior-y: none;
        }

        header {
            background-color: var(--primary-color);
            color: white; padding: 15px 0; text-align: center;
            position: sticky; top: 0; z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        h1 { margin: 0; font-size: 1.3rem; font-weight: 700; }

        .tabs {
            display: flex; background: white;
            position: sticky; top: 54px; z-index: 900;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .tab-btn {
            flex: 1; padding: 16px 5px; border: none; background: none;
            font-size: 0.9rem; font-weight: 600; color: var(--gray-text);
            cursor: pointer; border-bottom: 3px solid transparent;
        }

        .tab-btn.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }

        .search-container { padding: 12px; background: white; border-bottom: 1px solid var(--border-color); }
        #search-input {
            width: 100%; padding: 12px 15px; border: 1px solid #ccc;
            border-radius: 25px; font-size: 1rem; background-color: #f9f9f9; outline: none;
        }

        .filter-container {
            padding: 12px; background: white; overflow-x: auto;
            white-space: nowrap; border-bottom: 1px solid var(--border-color);
            display: flex; gap: 8px; -webkit-overflow-scrolling: touch;
        }

        .filter-label {
            display: inline-flex; align-items: center; font-size: 0.85rem;
            cursor: pointer; padding: 6px 12px; border-radius: 20px;
            background: #f0f0f0; border: 1px solid transparent;
        }
        
        .filter-label.is-active { background-color: #e8f5e9; color: var(--primary-color); border-color: var(--primary-light); }
        .filter-label.master { background-color: #333; color: white; }

        .view-section { display: none; padding: 12px; animation: fadeIn 0.2s ease; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .cat-title { font-weight: 800; font-size: 1.1rem; padding: 15px 5px 10px; color: var(--primary-color); border-bottom: 2px solid #eee; margin-bottom: 15px; }

        .product-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(105px, 1fr)); gap: 12px; margin-bottom: 20px;
        }

        .product-card {
            background: var(--card-bg); border-radius: 12px; padding: 10px;
            display: flex; flex-direction: column; justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); height: 100%; transition: transform 0.1s;
        }
        .product-card.in-cart { border: 2px solid var(--primary-color); background-color: #f1f8e9; }

        .card-header { text-align: center; margin-bottom: 8px; cursor: pointer; }
        .prod-icon { font-size: 2rem; display: block; margin-bottom: 4px; }
        .prod-name { font-weight: 600; font-size: 0.8rem; line-height: 1.2; display: block; height: 32px; overflow: hidden; }
        .prod-side { font-size: 0.65rem; color: #777; font-weight: bold; background: #eee; padding: 1px 4px; border-radius: 3px; }

        .controls { display: flex; align-items: center; justify-content: space-between; }
        .btn-ctrl { width: 32px; height: 32px; border-radius: 50%; border: none; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; }
        .btn-minus { background: white; color: var(--danger-color); border: 1px solid #ddd; }
        .btn-plus { background: var(--primary-color); color: white; }
        .qty-display { font-weight: 700; width: 20px; text-align: center; font-size: 0.9rem; }

        .shopping-list-item {
            background: white; padding: 12px; margin-bottom: 8px; border-radius: 10px;
            display: flex; align-items: center; justify-content: space-between; box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .shopping-list-item.checked { opacity: 0.5; }
        .shopping-list-item.checked .item-name-row { text-decoration: line-through; }
        
        .item-details { display: flex; flex-direction: column; margin-left: 10px; }
        .item-name-row { font-weight: 600; font-size: 1rem; }
        .item-info-row { font-size: 0.75rem; color: var(--gray-text); }

        .item-qty-badge {
            background: var(--primary-color); color: white; font-weight: bold;
            width: 32px; height: 32px; border-radius: 50%; display: flex;
            align-items: center; justify-content: center;
        }

        .bottom-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; background: white;
            padding: 15px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 1000; display: none;
        }
        .bottom-bar.visible { display: block; }
        .btn-pdf { width: 100%; padding: 16px; background: var(--primary-color); color: white; border: none; font-size: 1.1rem; font-weight: bold; border-radius: 12px; }
    </style>
</head>
<body>

    <header><h1>ðŸ›’ Meine Einkaufsliste</h1></header>

    <nav class="tabs">
        <button class="tab-btn active" onclick="app.switchTab('all')">Produkte</button>
        <button class="tab-btn" onclick="app.switchTab('cats')">Kategorien</button>
        <button class="tab-btn" onclick="app.switchTab('shop')">Einkaufen</button>
    </nav>

    <div id="search-wrapper" class="search-container">
        <input type="text" id="search-input" placeholder="Suchen..." oninput="app.handleSearch()">
    </div>

    <section id="view-all" class="view-section active"><div id="grid-container" class="product-grid"></div></section>
    
    <section id="view-cats" class="view-section">
        <div id="cat-filters" class="filter-container"></div>
        <div id="cat-list-container"></div>
    </section>

    <section id="view-shop" class="view-section"><div id="shopping-list-container"></div></section>

    <div id="shop-footer" class="bottom-bar">
        <button class="btn-pdf" onclick="app.exportPDF()">ðŸ“„ PDF exportieren</button>
    </div>

    <script>
        const CATALOG = [
            { name: "Erdbeeren", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ“" },
            { name: "Heidelbeeren", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ«" },
            { name: "Himbeeren", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ’" },
            { name: "Brokkoli", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ¥¦" },
            { name: "Champignons", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ„" },
            { name: "Karfiol", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ¥¦" },
            { name: "Lauch", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ¥¬" },
            { name: "Blattsalat", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ¥¬" },
            { name: "Eisbergsalat", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ¥¬" },
            { name: "Vogerlsalat", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ¥—" },
            { name: "Babyblattspinat", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸƒ" },
            { name: "Orangen", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸŠ" },
            { name: "Mandarinen", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸŠ" },
            { name: "Zitronen", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ‹" },
            { name: "Trauben", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ‡" },
            { name: "Avokado", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ¥‘" },
            { name: "Kiwi", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ¥" },
            { name: "Mango", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ¥­" },
            { name: "Birnen", category: "Obst & GemÃ¼se", side: "O", icon: "ðŸ" },
            { name: "Ã„pfel", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸŽ" },
            { name: "Bananen", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸŒ" },
            { name: "Zwiebeln", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ§…" },
            { name: "Kartoffeln", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ¥”" },
            { name: "SÃ¼ÃŸkartoffel", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ " },
            { name: "Ingwer", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ«š" },
            { name: "Knoblauch", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ§„" },
            { name: "Rote RÃ¼ben Frisch", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ¥”" },
            { name: "Rote RÃ¼ben Vorgekocht", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ¥”" },
            { name: "Karotten", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ¥•" },
            { name: "Gurken", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ¥’" },
            { name: "Paprika", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ«‘" },
            { name: "Melanzani", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ†" },
            { name: "Zucchini", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ¥’" },
            { name: "Kokosmilch", category: "Vorratsschrank", side: "O", icon: "ðŸ¥¥" },
            { name: "Tomaten", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ…" },
            { name: "Cocktailtomaten", category: "Obst & GemÃ¼se", side: "W", icon: "ðŸ…" },
            { name: "Walnusskerne", category: "Vorratsschrank", side: "O", icon: "ðŸ¥œ" },
            { name: "Cashewkerne", category: "Vorratsschrank", side: "O", icon: "ðŸ¥œ" },
            { name: "Brot", category: "Backwaren", side: "W", icon: "ðŸž" },
            { name: "Semmeln", category: "Backwaren", side: "W", icon: "ðŸ¥¯" },
            { name: "Zopf", category: "Backwaren", side: "W", icon: "ðŸž" },
            { name: "Wraps", category: "Backwaren", side: "W", icon: "ðŸŒ¯" },
            { name: "Haferflocken grob", category: "Vorratsschrank", side: "O", icon: "ðŸ¥£" },
            { name: "Haferflocken fein", category: "Vorratsschrank", side: "O", icon: "ðŸ¥£" },
            { name: "MÃ¼sli", category: "Vorratsschrank", side: "O", icon: "ðŸ¥£" },
            { name: "MÃ¼sliriegel", category: "SÃ¼ÃŸigkeiten", side: "W", icon: "ðŸ«" },
            { name: "Toastbrot", category: "Vorratsschrank", side: "O", icon: "ðŸž" },
            { name: "Kirschmarmelade", category: "Vorratsschrank", side: "O", icon: "ðŸ¯" },
            { name: "Marillenmarmelade", category: "Vorratsschrank", side: "O", icon: "ðŸ¯" },
            { name: "Powidelmarmelade", category: "Vorratsschrank", side: "O", icon: "ðŸ¯" },
            { name: "Erdbeermarmelade", category: "Vorratsschrank", side: "O", icon: "ðŸ¯" },
            { name: "Himbeermarmelade", category: "Vorratsschrank", side: "O", icon: "ðŸ¯" },
            { name: "Heidelbeermarmelade", category: "Vorratsschrank", side: "O", icon: "ðŸ¯" },
            { name: "Honig", category: "Vorratsschrank", side: "O", icon: "ðŸ¯" },
            { name: "Honig Quetschi", category: "Vorratsschrank", side: "O", icon: "ðŸ¯" },
            { name: "KrÃ¤utertee", category: "Vorratsschrank", side: "O", icon: "ðŸµ" },
            { name: "FrÃ¼chtetee", category: "Vorratsschrank", side: "O", icon: "ðŸµ" },
            { name: "Kaffee", category: "Vorratsschrank", side: "O", icon: "â˜•" },
            { name: "Vollmilchschokolade", category: "SÃ¼ÃŸigkeiten", side: "W", icon: "ðŸ«" },
            { name: "Zartbitterschokolade", category: "SÃ¼ÃŸigkeiten", side: "W", icon: "ðŸ«" },
            { name: "Chips", category: "SÃ¼ÃŸigkeiten", side: "W", icon: "ðŸ¥¨" },
            { name: "Kekse", category: "SÃ¼ÃŸigkeiten", side: "W", icon: "ðŸª" },
            { name: "GummibÃ¤rchen", category: "SÃ¼ÃŸigkeiten", side: "W", icon: "ðŸ»" },
            { name: "Wein", category: "GetrÃ¤nke", side: "O", icon: "ðŸ·" },
            { name: "Bier", category: "GetrÃ¤nke", side: "O", icon: "ðŸº" },
            { name: "Shampoo", category: "Haushalt", side: "O", icon: "ðŸ§´" },
            { name: "Bodylotion", category: "Haushalt", side: "O", icon: "ðŸ§´" },
            { name: "Deo", category: "Haushalt", side: "O", icon: "ðŸ§Š" },
            { name: "TaschentÃ¼cher", category: "Haushalt", side: "O", icon: "ðŸ¤§" },
            { name: "Zahnpasta", category: "Haushalt", side: "O", icon: "ðŸª¥" },
            { name: "ZahnbÃ¼rste", category: "Haushalt", side: "O", icon: "ðŸª¥" },
            { name: "GeschirrspÃ¼lertabs", category: "Haushalt", side: "O", icon: "ðŸ§¼" },
            { name: "SpÃ¼lmittel", category: "Haushalt", side: "O", icon: "ðŸ§¼" },
            { name: "Waschmittel", category: "Haushalt", side: "O", icon: "ðŸ§º" },
            { name: "Klopapier", category: "Haushalt", side: "O", icon: "ðŸ§»" },
            { name: "KÃ¼chenrolle", category: "Haushalt", side: "O", icon: "ðŸ§»" },
            { name: "MÃ¼llbeutel", category: "Haushalt", side: "O", icon: "ðŸ—‘ï¸" },
            { name: "Vanilleeis", category: "TiefkÃ¼hl", side: "O", icon: "ðŸ¦" },
            { name: "TiefkÃ¼hlhimbeeren", category: "TiefkÃ¼hl", side: "O", icon: "ðŸ§Š" },
            { name: "TiefkÃ¼hlbeeren", category: "TiefkÃ¼hl", side: "O", icon: "ðŸ§Š" },
            { name: "Weizenvollkornmehl", category: "Vorratsschrank", side: "O", icon: "ðŸŒ¾" },
            { name: "Roggenmehl", category: "Vorratsschrank", side: "O", icon: "ðŸŒ¾" },
            { name: "Dinkelmehl", category: "Vorratsschrank", side: "O", icon: "ðŸŒ¾" },
            { name: "Weizenmehl", category: "Vorratsschrank", side: "O", icon: "ðŸŒ¾" },
            { name: "Dinkelvollkornmehl", category: "Vorratsschrank", side: "O", icon: "ðŸŒ¾" },
            { name: "WeizengrieÃŸ", category: "Vorratsschrank", side: "O", icon: "ðŸŒ¾" },
            { name: "MaisgrieÃŸ", category: "Vorratsschrank", side: "O", icon: "ðŸŒ¾" },
            { name: "Zucker", category: "Vorratsschrank", side: "O", icon: "ðŸš" },
            { name: "Rohrzucker", category: "Vorratsschrank", side: "O", icon: "ðŸš" },
            { name: "Ã–l", category: "Vorratsschrank", side: "O", icon: "ðŸ§´" },
            { name: "Apfelessig", category: "Vorratsschrank", side: "O", icon: "ðŸ¾" },
            { name: "Balsamicoessig", category: "Vorratsschrank", side: "O", icon: "ðŸ¾" },
            { name: "Kochschokolade", category: "Vorratsschrank", side: "O", icon: "ðŸ«" },
            { name: "Rosinen", category: "Vorratsschrank", side: "O", icon: "ðŸ‡" },
            { name: "Trockenhefe", category: "Vorratsschrank", side: "O", icon: "ðŸž" },
            { name: "Vanillezucker", category: "Vorratsschrank", side: "O", icon: "ðŸš" },
            { name: "Staubzucker", category: "Vorratsschrank", side: "O", icon: "ðŸš" },
            { name: "KnÃ¶delbrot", category: "Vorratsschrank", side: "O", icon: "ðŸž" },
            { name: "Eier", category: "Vorratsschrank", side: "O", icon: "ðŸ¥š" },
            { name: "Salz", category: "Vorratsschrank", side: "O", icon: "ðŸ§‚" },
            { name: "Pfeffer", category: "Vorratsschrank", side: "O", icon: "ðŸ§‚" },
            { name: "Currypulver", category: "Vorratsschrank", side: "O", icon: "ðŸ›" },
            { name: "Paprikapulver", category: "Vorratsschrank", side: "O", icon: "ðŸŒ¶ï¸" },
            { name: "GewÃ¼rze", category: "Vorratsschrank", side: "O", icon: "ðŸŒ¿" },
            { name: "Faschiertes", category: "KÃ¼hlung", side: "O", icon: "ðŸ¥©" },
            { name: "HÃ¼hnerfleisch", category: "KÃ¼hlung", side: "O", icon: "ðŸ—" },
            { name: "Hefe", category: "KÃ¼hlung", side: "O", icon: "ðŸž" },
            { name: "Gnocchi frisch", category: "KÃ¼hlung", side: "O", icon: "ðŸ¥Ÿ" },
            { name: "KÃ¤se", category: "KÃ¼hlung", side: "O", icon: "ðŸ§€" },
            { name: "Topfen", category: "KÃ¼hlung", side: "O", icon: "ðŸ¥›" },
            { name: "FrischkÃ¤se", category: "KÃ¼hlung", side: "O", icon: "ðŸ¥¯" },
            { name: "TomatenstÃ¼cke (Dose)", category: "Vorratsschrank", side: "O", icon: "ðŸ¥«" },
            { name: "Dosenbohnen", category: "Vorratsschrank", side: "O", icon: "ðŸ¥«" },
            { name: "Dosenlinsen", category: "Vorratsschrank", side: "O", icon: "ðŸ¥«" },
            { name: "Dosenkichererbsen", category: "Vorratsschrank", side: "O", icon: "ðŸ¥«" },
            { name: "Mais im Glas", category: "Vorratsschrank", side: "O", icon: "ðŸŒ½" },
            { name: "Tomatensauce", category: "Vorratsschrank", side: "O", icon: "ðŸ¥«" },
            { name: "Spaghetti", category: "Vorratsschrank", side: "O", icon: "ðŸ" },
            { name: "Vollkornspaghetti", category: "Vorratsschrank", side: "O", icon: "ðŸ" },
            { name: "Fussili / Spiralnudeln", category: "Vorratsschrank", side: "O", icon: "ðŸ" },
            { name: "Basmatireis / Reis", category: "Vorratsschrank", side: "O", icon: "ðŸš" },
            { name: "TiefkÃ¼hlblattspinat", category: "TiefkÃ¼hl", side: "O", icon: "ðŸ§Š" },
            { name: "TiefkÃ¼hlcremespinat", category: "TiefkÃ¼hl", side: "O", icon: "ðŸ§Š" },
            { name: "TiefkÃ¼hlgemÃ¼se", category: "TiefkÃ¼hl", side: "O", icon: "â„ï¸" },
            { name: "TiefkÃ¼hlpizza", category: "TiefkÃ¼hl", side: "O", icon: "ðŸ•" },
            { name: "Joghurt", category: "KÃ¼hlung", side: "O", icon: "ðŸ¥›" },
            { name: "Sahne", category: "KÃ¼hlung", side: "O", icon: "ðŸ¥›" },
            { name: "Sauerrahm", category: "KÃ¼hlung", side: "O", icon: "ðŸ¥›" },
            { name: "Butter", category: "KÃ¼hlung", side: "O", icon: "ðŸ§ˆ" },
            { name: "Milch", category: "KÃ¼hlung", side: "O", icon: "ðŸ¥›" },
            { name: "Mineralwasser", category: "GetrÃ¤nke", side: "O", icon: "ðŸ’§" },
            { name: "Sirup", category: "GetrÃ¤nke", side: "O", icon: "ðŸ¥¤" },
            { name: "Cola", category: "GetrÃ¤nke", side: "O", icon: "ðŸ¥¤" },
            { name: "Apfelsaft", category: "GetrÃ¤nke", side: "O", icon: "ðŸ§ƒ" },
            { name: "Batterien", category: "Kassa", side: "O", icon: "ðŸ”‹" }
        ];

        const app = {
            cart: {}, searchTerm: '', activeTab: 'all', activeCategories: [], allCats: [],

            init: function() {
                const stored = localStorage.getItem('shoppingCart_v3');
                if (stored) this.cart = JSON.parse(stored);
                this.allCats = [...new Set(CATALOG.map(p => p.category))];
                this.activeCategories = [...this.allCats];
                this.renderCategoryFilters();
                this.renderProductGrid();
            },

            save: function() { localStorage.setItem('shoppingCart_v3', JSON.stringify(this.cart)); },

            updateQty: function(name, delta) {
                if (!this.cart[name]) this.cart[name] = { qty: 0, checked: false };
                this.cart[name].qty += delta;
                if (this.cart[name].qty <= 0) delete this.cart[name];
                this.save();
                this.refreshCurrentView();
            },

            toggleCheck: function(name) {
                if (this.cart[name]) { this.cart[name].checked = !this.cart[name].checked; this.save(); this.renderShoppingList(); }
            },

            switchTab: function(tab) {
                this.activeTab = tab;
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.innerText.toLowerCase().includes(tab.substring(0,3))));
                document.querySelectorAll('.view-section').forEach(s => s.classList.toggle('active', s.id === 'view-' + tab));
                document.getElementById('search-wrapper').style.display = tab === 'shop' ? 'none' : 'block';
                document.getElementById('shop-footer').classList.toggle('visible', tab === 'shop');
                this.refreshCurrentView();
            },

            handleSearch: function() { this.searchTerm = document.getElementById('search-input').value.toLowerCase(); this.refreshCurrentView(); },

            refreshCurrentView: function() {
                if (this.activeTab === 'all') this.renderProductGrid();
                else if (this.activeTab === 'cats') this.renderCategoryView();
                else if (this.activeTab === 'shop') this.renderShoppingList();
            },

            createCard: function(p) {
                const qty = this.cart[p.name]?.qty || 0;
                return `<div class="product-card ${qty>0?'in-cart':''}">
                    <div class="card-header" onclick="app.updateQty('${p.name}', 1)">
                        <span class="prod-icon">${p.icon}</span>
                        <span class="prod-name">${p.name}</span>
                        <span class="prod-side">${p.side}</span>
                    </div>
                    <div class="controls">
                        <button class="btn-ctrl btn-minus" onclick="app.updateQty('${p.name}', -1)">-</button>
                        <span class="qty-display">${qty>0?qty:''}</span>
                        <button class="btn-ctrl btn-plus" onclick="app.updateQty('${p.name}', 1)">+</button>
                    </div>
                </div>`;
            },

            renderProductGrid: function() {
                const filtered = CATALOG.filter(p => p.name.toLowerCase().includes(this.searchTerm));
                document.getElementById('grid-container').innerHTML = filtered.map(p => this.createCard(p)).join('');
            },

            renderCategoryView: function() {
                const container = document.getElementById('cat-list-container');
                container.innerHTML = '';
                const filtered = CATALOG.filter(p => p.name.toLowerCase().includes(this.searchTerm) && this.activeCategories.includes(p.category));
                const groups = {};
                filtered.forEach(p => { if (!groups[p.category]) groups[p.category] = []; groups[p.category].push(p); });
                
                this.allCats.forEach(cat => {
                    if (groups[cat]) {
                        container.innerHTML += `<div class="cat-group"><div class="cat-title">${cat}</div><div class="product-grid">${groups[cat].map(p => this.createCard(p)).join('')}</div></div>`;
                    }
                });
            },

            renderCategoryFilters: function() {
                const container = document.getElementById('cat-filters');
                const allSel = this.activeCategories.length === this.allCats.length;
                container.innerHTML = `<label class="filter-label master ${allSel?'is-active':''}" onclick="app.toggleAllCats(${allSel})">${allSel?'Alle aus':'Alle an'}</label>`;
                this.allCats.forEach(c => {
                    const active = this.activeCategories.includes(c);
                    container.innerHTML += `<label class="filter-label ${active?'is-active':''}" onclick="app.toggleCat('${c}')">${c}</label>`;
                });
            },

            toggleCat: function(c) {
                if (this.activeCategories.includes(c)) this.activeCategories = this.activeCategories.filter(x => x !== c);
                else this.activeCategories.push(c);
                this.renderCategoryFilters(); this.renderCategoryView();
            },

            toggleAllCats: function(allActive) {
                this.activeCategories = allActive ? [] : [...this.allCats];
                this.renderCategoryFilters(); this.renderCategoryView();
            },

            renderShoppingList: function() {
                const items = CATALOG.filter(p => this.cart[p.name]).map(p => ({...p, ...this.cart[p.name]}));
                const container = document.getElementById('shopping-list-container');
                if (items.length === 0) { container.innerHTML = '<div style="text-align:center;margin-top:50px;color:#888;">Liste leer.</div>'; return; }
                container.innerHTML = items.map(item => `
                    <div class="shopping-list-item ${item.checked?'checked':''}">
                        <div style="display:flex;align-items:center;gap:12px;flex:1;">
                            <input type="checkbox" class="checkbox-custom" ${item.checked?'checked':''} onchange="app.toggleCheck('${item.name}')">
                            <span style="font-size:1.5rem">${item.icon}</span>
                            <div class="item-details">
                                <span class="item-name-row">${item.name}</span>
                                <span class="item-info-row">${item.side} â€¢ ${item.category}</span>
                            </div>
                        </div>
                        <div class="item-qty-badge">${item.qty}</div>
                    </div>
                `).join('');
                this.currentList = items;
            },

            textToImg: function(emoji) {
                const c = document.createElement("canvas"); c.width = 40; c.height = 40;
                const ctx = c.getContext("2d"); ctx.font = "30px serif"; ctx.textAlign = "center"; ctx.textBaseline = "middle";
                ctx.fillText(emoji, 20, 22); return c.toDataURL("image/png");
            },

            exportPDF: function() {
                if (!this.currentList) return;
                const { jsPDF } = window.jspdf; const doc = new jsPDF();
                doc.setFillColor(46, 125, 50); doc.rect(0, 0, 210, 25, 'F');
                doc.setFont("helvetica", "bold"); doc.setTextColor(255); doc.text("Einkaufsliste", 15, 17);
                let y = 40;
                this.currentList.forEach(item => {
                    if (y > 280) { doc.addPage(); y = 20; }
                    doc.rect(15, y-5, 5, 5);
                    try { doc.addImage(this.textToImg(item.icon), 'PNG', 22, y-7, 7, 7); } catch(e){}
                    doc.setTextColor(0); doc.setFontSize(12); doc.text(`${item.name}`, 32, y);
                    doc.setFillColor(46, 125, 50); doc.circle(130, y-2, 3.5, 'F');
                    doc.setTextColor(255); doc.setFontSize(10); doc.text(item.qty.toString(), 130, y-0.5, {align:'center', baseline:'middle'});
                    doc.setTextColor(150); doc.text(item.side, 190, y, {align:'right'});
                    y += 10;
                });
                doc.save("einkaufsliste.pdf");
            }
        };

        document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>