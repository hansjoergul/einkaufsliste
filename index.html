<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Unsere Einkaufsliste</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root {
            --primary-color: #2E7D32; 
            --bg-color: #f4f4f9;
            --card-bg: #ffffff;
            --text-color: #222;
            --gray-text: #666;
            --border-color: #ddd;
            --danger-color: #d32f2f;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: sans-serif;
            margin: 0; background-color: var(--bg-color);
            color: var(--text-color);
            padding-bottom: 120px; 
        }

        header {
            background-color: var(--primary-color);
            color: white; padding: 15px; text-align: center;
            position: sticky; top: 0; z-index: 1000;
        }

        .tabs {
            display: flex; background: white;
            position: sticky; top: 54px; z-index: 900;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .tab-btn {
            flex: 1; padding: 15px; border: none; background: none;
            font-weight: bold; color: #666; cursor: pointer;
        }

        .tab-btn.active { color: var(--primary-color); border-bottom: 3px solid var(--primary-color); }

        .search-container { padding: 10px; background: white; }
        #search-input {
            width: 100%; padding: 12px; border: 1px solid #ccc;
            border-radius: 25px; font-size: 1rem;
        }

        .view-section { display: none; padding: 12px; }
        .view-section.active { display: block; }

        .cat-title { font-weight: bold; margin: 20px 0 10px; color: var(--primary-color); border-bottom: 1px solid #ddd; }

        .product-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px;
        }

        .product-card {
            background: white; padding: 10px; border-radius: 12px; text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: relative;
        }
        .product-card.in-cart { border: 2px solid var(--primary-color); background: #f1f8e9; }

        .prod-icon { font-size: 2rem; display: block; }
        .prod-name { font-size: 0.8rem; font-weight: bold; display: block; margin: 5px 0; min-height: 30px; display: flex; align-items: center; justify-content: center;}

        .controls { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; }
        .btn-ctrl { width: 28px; height: 28px; border-radius: 50%; border: 1px solid #ccc; background: white; font-weight: bold; }
        .btn-plus { background: var(--primary-color); color: white; border: none; }

        /* --- SHOPPING LIST NEU / √úBERSICHTLICH --- */
        .shopping-list-item {
            background: white; margin-bottom: 8px; padding: 12px; border-radius: 10px;
            display: flex; align-items: center; justify-content: space-between; box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .shopping-list-item.checked { opacity: 0.5; }
        .shopping-list-item.checked .item-name-row { text-decoration: line-through; color: var(--gray-text); }
        
        .item-left { display: flex; align-items: center; gap: 12px; flex: 1; cursor: pointer; }
        .checkbox-custom { width: 24px; height: 24px; accent-color: var(--primary-color); cursor: pointer; }
        
        .item-details { display: flex; flex-direction: column; }
        .item-name-row { font-weight: 600; font-size: 1.05rem; }
        .item-info-row { font-size: 0.75rem; color: var(--gray-text); }

        .item-qty-badge {
            background: var(--primary-color); color: white; font-weight: bold;
            width: 32px; height: 32px; border-radius: 50%; display: flex;
            align-items: center; justify-content: center; font-size: 0.95rem;
            flex-shrink: 0; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* --- FOOTER --- */
        .bottom-bar {
            position: fixed; bottom: 0; width: 100%; padding: 15px; background: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1); display: none;
            display: flex; gap: 10px; 
        }
        #shop-footer { display: none; }
        #shop-footer.visible { display: flex; }

        .btn-action { flex: 1; padding: 15px; border: none; border-radius: 10px; font-weight: bold; color: white; cursor: pointer; }
        .btn-pdf { background: var(--primary-color); }
        .btn-reset { background: var(--danger-color); }
    </style>
</head>
<body>

    <header><h1>üõí Unsere Cloud-Liste</h1></header>

    <nav class="tabs">
        <button class="tab-btn active" onclick="app.switchTab('all')">Produkte</button>
        <button class="tab-btn" onclick="app.switchTab('cats')">Kategorien</button>
        <button class="tab-btn" onclick="app.switchTab('shop')">Einkaufen</button>
    </nav>

    <div id="search-wrapper" class="search-container">
        <input type="text" id="search-input" placeholder="Suchen..." oninput="app.handleSearch()">
    </div>

    <section id="view-all" class="view-section active"><div id="grid-container" class="product-grid"></div></section>
    <section id="view-cats" class="view-section"><div id="cat-list-container"></div></section>
    <section id="view-shop" class="view-section"><div id="shopping-list-container"></div></section>

    <div id="shop-footer" class="bottom-bar">
        <button class="btn-action btn-reset" onclick="app.clearCart()">üóëÔ∏è Alles L√∂schen</button>
        <button class="btn-action btn-pdf" onclick="app.exportPDF()">üìÑ PDF</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBDchXMOrJO3Qy9yQISP87vOeE7vZU5yD4",
            authDomain: "einkaufsliste-746a1.firebaseapp.com",
            databaseURL: "https://einkaufsliste-746a1-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "einkaufsliste-746a1",
            storageBucket: "einkaufsliste-746a1.firebasestorage.app",
            messagingSenderId: "152718589857",
            appId: "1:152718589857:web:896512392d7ae7c3e995e0"
        };

        const fApp = initializeApp(firebaseConfig);
        const db = getDatabase(fApp);
        const dbRef = ref(db, 'shared-shopping-list');

        // Die exakte Reihenfolge bleibt hier erhalten!
        const CATALOG = [
            { name: "Erdbeeren", category: "Obst & Gem√ºse", side: "W", icon: "üçì" },
            { name: "Heidelbeeren", category: "Obst & Gem√ºse", side: "W", icon: "ü´ê" },
            { name: "Himbeeren", category: "Obst & Gem√ºse", side: "W", icon: "üçí" },
            { name: "Brokkoli", category: "Obst & Gem√ºse", side: "W", icon: "ü•¶" },
            { name: "Champignons", category: "Obst & Gem√ºse", side: "W", icon: "üçÑ" },
            { name: "Karfiol", category: "Obst & Gem√ºse", side: "W", icon: "ü•¶" },
            { name: "Lauch", category: "Obst & Gem√ºse", side: "W", icon: "üßÖ" },
            { name: "Blattsalat", category: "Obst & Gem√ºse", side: "W", icon: "ü•¨" },
            { name: "Eisbergsalat", category: "Obst & Gem√ºse", side: "W", icon: "ü•¨" },
            { name: "Vogerlsalat", category: "Obst & Gem√ºse", side: "W", icon: "ü•¨" },
            { name: "Babyblattspinat", category: "Obst & Gem√ºse", side: "W", icon: "üçÉ" },
            { name: "Orangen", category: "Obst & Gem√ºse", side: "W", icon: "üçä" },
            { name: "Mandarinen", category: "Obst & Gem√ºse", side: "W", icon: "üçä" },
            { name: "Zitronen", category: "Obst & Gem√ºse", side: "W", icon: "üçã" },
            { name: "Trauben", category: "Obst & Gem√ºse", side: "W", icon: "üçá" },
            { name: "Avokado", category: "Obst & Gem√ºse", side: "W", icon: "ü•ë" },
            { name: "Kiwi", category: "Obst & Gem√ºse", side: "W", icon: "ü•ù" },
            { name: "Mango", category: "Obst & Gem√ºse", side: "W", icon: "ü•≠" },
            { name: "Birnen", category: "Obst & Gem√ºse", side: "O", icon: "üçê" },
            { name: "√Ñpfel", category: "Obst & Gem√ºse", side: "W", icon: "üçé" },
            { name: "Bananen", category: "Obst & Gem√ºse", side: "W", icon: "üçå" },
            { name: "Zwiebeln", category: "Obst & Gem√ºse", side: "W", icon: "üßÖ" },
            { name: "Kartoffeln", category: "Obst & Gem√ºse", side: "W", icon: "ü•î" },
            { name: "S√º√ükartoffel", category: "Obst & Gem√ºse", side: "W", icon: "üç†" },
            { name: "Ingwer", category: "Obst & Gem√ºse", side: "W", icon: "ü´ö" },
            { name: "Knoblauch", category: "Obst & Gem√ºse", side: "W", icon: "üßÑ" },
            { name: "Rote R√ºben Frisch", category: "Obst & Gem√ºse", side: "W", icon: "ü•î" },
            { name: "Rote R√ºben Vorgekocht", category: "Obst & Gem√ºse", side: "W", icon: "ü•î" },
            { name: "Karotten", category: "Obst & Gem√ºse", side: "W", icon: "ü•ï" },
            { name: "Gurken", category: "Obst & Gem√ºse", side: "W", icon: "ü•í" },
            { name: "Paprika", category: "Obst & Gem√ºse", side: "W", icon: "ü´ë" },
            { name: "Melanzani", category: "Obst & Gem√ºse", side: "W", icon: "üçÜ" },
            { name: "Zuchini", category: "Obst & Gem√ºse", side: "W", icon: "ü•í" },
            { name: "Kokosmilch", category: "Vorratsschrank", side: "O", icon: "ü••" },
            { name: "Tomaten", category: "Obst & Gem√ºse", side: "W", icon: "üçÖ" },
            { name: "Cocktailtomaten", category: "Obst & Gem√ºse", side: "W", icon: "üçÖ" },
            { name: "Walnusskerne", category: "Vorratsschrank", side: "O", icon: "ü•ú" },
            { name: "Cashewkerne", category: "Vorratsschrank", side: "O", icon: "ü•ú" },
            { name: "Brot", category: "Backwaren", side: "W", icon: "ü•ñ" },
            { name: "Semmeln", category: "Backwaren", side: "W", icon: "ü•ñ" },
            { name: "Zopf", category: "Backwaren", side: "W", icon: "ü•ñ" },
            { name: "Wraps", category: "Backwaren", side: "W", icon: "üåØ" },
            { name: "Haferflocken grob", category: "Vorratsschrank", side: "O", icon: "ü•£" },
            { name: "Haferflocken fein", category: "Vorratsschrank", side: "O", icon: "ü•£" },
            { name: "M√ºsli", category: "Vorratsschrank", side: "O", icon: "ü•£" },
            { name: "M√ºsliriegel", category: "S√º√üigkeiten", side: "W", icon: "üç´" },
            { name: "Toastbrot", category: "Vorratsschrank", side: "O", icon: "üçû" },
            { name: "Kirschmarmelade", category: "Vorratsschrank", side: "O", icon: "üçí" },
            { name: "Marillenmarmelade", category: "Vorratsschrank", side: "O", icon: "üçë" },
            { name: "Powidelmarmelade", category: "Vorratsschrank", side: "O", icon: "üçØ" },
            { name: "Erdbeermarmelade", category: "Vorratsschrank", side: "O", icon: "üçì" },
            { name: "Himbeermarmelade", category: "Vorratsschrank", side: "O", icon: "üçì" },
            { name: "Heidelbeermarmelade", category: "Vorratsschrank", side: "O", icon: "ü´ê" },
            { name: "Honig", category: "Vorratsschrank", side: "O", icon: "üçØ" },
            { name: "Honig Quetschi", category: "Vorratsschrank", side: "O", icon: "üçØ" },
            { name: "Kr√§utertee", category: "Vorratsschrank", side: "O", icon: "üçµ" },
            { name: "Fr√ºchtetee", category: "Vorratsschrank", side: "O", icon: "üçµ" },
            { name: "Kaffee", category: "Vorratsschrank", side: "O", icon: "‚òï" },
            { name: "Vollmilchschokolade", category: "S√º√üigkeiten", side: "W", icon: "üç´" },
            { name: "Zartbitterschokolade", category: "S√º√üigkeiten", side: "W", icon: "üç´" },
            { name: "Chips", category: "S√º√üigkeiten", side: "W", icon: "ü•®" },
            { name: "Kekse", category: "S√º√üigkeiten", side: "W", icon: "üç™" },
            { name: "Gummib√§rchen", category: "S√º√üigkeiten", side: "W", icon: "üêª" },
            { name: "Wein", category: "Getr√§nke", side: "O", icon: "üç∑" },
            { name: "Bier", category: "Getr√§nke", side: "O", icon: "üç∫" },
            { name: "Shampoo", category: "Haushalt", side: "O", icon: "üß¥" },
            { name: "Bodylotion", category: "Haushalt", side: "O", icon: "üß¥" },
            { name: "Deo", category: "Haushalt", side: "O", icon: "üßä" },
            { name: "Taschent√ºcher", category: "Haushalt", side: "O", icon: "ü§ß" },
            { name: "Zahnpasta", category: "Haushalt", side: "O", icon: "ü™•" },
            { name: "Zahnb√ºrste", category: "Haushalt", side: "O", icon: "ü™•" },
            { name: "Geschirrsp√ºlertabs", category: "Haushalt", side: "O", icon: "üßº" },
            { name: "Sp√ºlmittel", category: "Haushalt", side: "O", icon: "üßº" },
            { name: "Waschmittel", category: "Haushalt", side: "O", icon: "üß∫" },
            { name: "Klopapier", category: "Haushalt", side: "O", icon: "üßª" },
            { name: "K√ºchenrolle", category: "Haushalt", side: "O", icon: "üßª" },
            { name: "M√ºllbeutel", category: "Haushalt", side: "O", icon: "üóëÔ∏è" },
            { name: "Vanilleeis", category: "Tiefk√ºhl", side: "O", icon: "üç¶" },
            { name: "Tiefk√ºhlhimbeeren", category: "Tiefk√ºhl", side: "O", icon: "üßä" },
            { name: "Tiefk√ºhlbeeren", category: "Tiefk√ºhl", side: "O", icon: "üßä" },
            { name: "Dosenbohnen", category: "Vorratsschrank", side: "O", icon: "ü•´" },
            { name: "Dosenlinsen", category: "Vorratsschrank", side: "O", icon: "ü•´" },
            { name: "Dosenkichererbsen", category: "Vorratsschrank", side: "O", icon: "ü•´" },
            { name: "Mais im Glas", category: "Vorratsschrank", side: "O", icon: "üåΩ" },
            { name: "Weizenvollkornmehl", category: "Vorratsschrank", side: "O", icon: "üåæ" },
            { name: "Roggenmehl", category: "Vorratsschrank", side: "O", icon: "üåæ" },
            { name: "Dinkelmehl", category: "Vorratsschrank", side: "O", icon: "üåæ" },
            { name: "Weizenmehl", category: "Vorratsschrank", side: "O", icon: "üåæ" },
            { name: "Dinkelvollkornmehl", category: "Vorratsschrank", side: "O", icon: "üåæ" },
            { name: "Weizengrie√ü", category: "Vorratsschrank", side: "O", icon: "üåæ" },
            { name: "Maisgrie√ü", category: "Vorratsschrank", side: "O", icon: "üåæ" },
            { name: "Zucker", category: "Vorratsschrank", side: "O", icon: "üçö" },
            { name: "Rohrzucker", category: "Vorratsschrank", side: "O", icon: "üçö" },
            { name: "Oliven√∂l", category: "Vorratsschrank", side: "O", icon: "üß¥" },
            { name: "Sonneblumen√∂l", category: "Vorratsschrank", side: "O", icon: "üß¥" },
            { name: "Raps√∂l", category: "Vorratsschrank", side: "O", icon: "üß¥" },
            { name: "Apfelessig", category: "Vorratsschrank", side: "O", icon: "üçæ" },
            { name: "Balsamicoessig", category: "Vorratsschrank", side: "O", icon: "üçæ" },
            { name: "Kochschokolade", category: "Vorratsschrank", side: "O", icon: "üç´" },
            { name: "Vanillepudding", category: "Vorratsschrank", side: "O", icon: "üçÆ" },
            { name: "Schokopudding", category: "Vorratsschrank", side: "O", icon: "üçÆ" },
            { name: "Rosinen", category: "Vorratsschrank", side: "O", icon: "üçá" },
            { name: "Trockenhefe", category: "Vorratsschrank", side: "O", icon: "üçû" },
            { name: "Vanillezucker", category: "Vorratsschrank", side: "O", icon: "ü•°" },
            { name: "Staubzucker", category: "Vorratsschrank", side: "O", icon: "üçö" },
            { name: "Kn√∂delbrot", category: "Vorratsschrank", side: "O", icon: "üçû" },
            { name: "Eier", category: "Vorratsschrank", side: "O", icon: "ü•ö" },
            { name: "Salz", category: "Vorratsschrank", side: "O", icon: "üßÇ" },
            { name: "Pfeffer", category: "Vorratsschrank", side: "O", icon: "üßÇ" },
            { name: "Currypulver", category: "Vorratsschrank", side: "O", icon: "üçõ" },
            { name: "Paprikapulver", category: "Vorratsschrank", side: "O", icon: "üå∂Ô∏è" },
            { name: "Muskat", category: "Vorratsschrank", side: "O", icon: "üå∞" },
            { name: "Zimt", category: "Vorratsschrank", side: "O", icon: "ü™µ" },
            { name: "Gew√ºrze", category: "Vorratsschrank", side: "O", icon: "üåø" },
            { name: "Faschiertes", category: "K√ºhlung", side: "O", icon: "ü•©" },
            { name: "H√ºhnerfleisch", category: "K√ºhlung", side: "O", icon: "üçó" },
            { name: "Hefe", category: "K√ºhlung", side: "O", icon: "üçû" },
            { name: "Gnocchi frisch", category: "K√ºhlung", side: "O", icon: "ü•ü" },
            { name: "Hirtenk√§se", category: "K√ºhlung", side: "O", icon: "üßÄ" },
            { name: "Parmesan", category: "K√ºhlung", side: "O", icon: "üßÄ" },
            { name: "Pizzak√§se", category: "K√ºhlung", side: "O", icon: "üßÄ" },
            { name: "Mozarella", category: "K√ºhlung", side: "O", icon: "üßÄ" },
            { name: "Steirischer Bergk√§se", category: "K√ºhlung", side: "O", icon: "üßÄ" },
            { name: "K√§sescheiben", category: "K√ºhlung", side: "O", icon: "üßÄ" },
            { name: "Topfen", category: "K√ºhlung", side: "O", icon: "ü•õ" },
            { name: "Frischk√§se", category: "K√ºhlung", side: "O", icon: "ü•Ø" },
            { name: "Tomatenst√ºcke (Dose)", category: "Vorratsschrank", side: "O", icon: "ü•´" },
            { name: "Thunfisch", category: "Vorratsschrank", side: "O", icon: "ü•´" },
            { name: "Oliven", category: "Vorratsschrank", side: "O", icon: "ü´í" },
            { name: "Tomatensauce", category: "Vorratsschrank", side: "O", icon: "ü•´" },
            { name: "Spaghetti", category: "Vorratsschrank", side: "O", icon: "üçù" },
            { name: "Vollkornspaghetti", category: "Vorratsschrank", side: "O", icon: "üçù" },
            { name: "Fussili / Spiralnudeln", category: "Vorratsschrank", side: "O", icon: "üçù" },
            { name: "Basmatireis / Reis", category: "Vorratsschrank", side: "O", icon: "üçö" },
            { name: "Tiefk√ºhlblattspinat", category: "Tiefk√ºhl", side: "O", icon: "üßä" },
            { name: "Tiefk√ºhlcremespinat", category: "Tiefk√ºhl", side: "O", icon: "üßä" },
            { name: "Tiefk√ºhlgem√ºse", category: "Tiefk√ºhl", side: "O", icon: "‚ùÑÔ∏è" },
            { name: "Tiefk√ºhlpizza", category: "Tiefk√ºhl", side: "O", icon: "üçï" },
            { name: "Pommes", category: "Tiefk√ºhl", side: "O", icon: "üçü" },
            { name: "S√º√ükartoffelpommes", category: "Tiefk√ºhl", side: "O", icon: "üçü" },
            { name: "Tiefk√ºhlerbsen", category: "Tiefk√ºhl", side: "O", icon: "ü´õ" },
            { name: "Tiefk√ºhlkarfiol", category: "Tiefk√ºhl", side: "O", icon: "‚ùÑÔ∏è" },
            { name: "Tiefk√ºhlbrokkoli", category: "Tiefk√ºhl", side: "O", icon: "ü•¶" },
            { name: "Fruchtjoghurt", category: "K√ºhlung", side: "O", icon: "ü•õ" },
            { name: "Joghurt", category: "K√ºhlung", side: "O", icon: "ü•õ" },
            { name: "Sahne", category: "K√ºhlung", side: "O", icon: "ü•õ" },
            { name: "Creme Fraiche", category: "K√ºhlung", side: "O", icon: "ü•õ" },
            { name: "Sauerrahm", category: "K√ºhlung", side: "O", icon: "ü•õ" },
            { name: "Butter", category: "K√ºhlung", side: "O", icon: "üßà" },
            { name: "Milch", category: "K√ºhlung", side: "O", icon: "ü•õ" },
            { name: "Mineralwasser", category: "Getr√§nke", side: "O", icon: "üíß" },
            { name: "Sirup", category: "Getr√§nke", side: "O", icon: "ü•§" },
            { name: "Cola", category: "Getr√§nke", side: "O", icon: "ü•§" },
            { name: "Apfelsaft", category: "Getr√§nke", side: "O", icon: "üßÉ" }
        ];

        window.app = {
            cart: {}, searchTerm: '', activeTab: 'all',

            init: function() {
                onValue(dbRef, (snapshot) => {
                    this.cart = snapshot.val() || {};
                    this.refreshCurrentView();
                });
            },

            saveToCloud: function() {
                set(dbRef, this.cart);
            },

            // Alles l√∂schen Funktion
            clearCart: function() {
                if(confirm("Bist du sicher, dass du die komplette Einkaufsliste l√∂schen m√∂chtest?")) {
                    set(dbRef, {}); 
                }
            },

            updateQty: function(name, delta) {
                if (!this.cart[name]) this.cart[name] = { qty: 0, checked: false };
                this.cart[name].qty += delta;
                if (this.cart[name].qty <= 0) delete this.cart[name];
                this.saveToCloud();
            },

            toggleCheck: function(name) {
                if (this.cart[name]) {
                    this.cart[name].checked = !this.cart[name].checked;
                    this.saveToCloud();
                }
            },

            switchTab: function(tab) {
                this.activeTab = tab;
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.onclick.toString().includes(tab)));
                document.querySelectorAll('.view-section').forEach(s => s.classList.toggle('active', s.id === 'view-' + tab));
                
                const footer = document.getElementById('shop-footer');
                if(tab === 'shop') footer.classList.add('visible');
                else footer.classList.remove('visible');

                this.refreshCurrentView();
            },

            handleSearch: function() {
                this.searchTerm = document.getElementById('search-input').value.toLowerCase();
                this.refreshCurrentView();
            },

            refreshCurrentView: function() {
                if (this.activeTab === 'all') this.renderGrid();
                if (this.activeTab === 'cats') this.renderCats();
                if (this.activeTab === 'shop') this.renderShop();
            },

            renderGrid: function() {
                const filtered = CATALOG.filter(p => p.name.toLowerCase().includes(this.searchTerm));
                document.getElementById('grid-container').innerHTML = filtered.map(p => this.createCard(p)).join('');
            },

            renderCats: function() {
                const container = document.getElementById('cat-list-container');
                container.innerHTML = '';
                const cats = [...new Set(CATALOG.map(p => p.category))];
                cats.forEach(cat => {
                    const items = CATALOG.filter(p => p.category === cat && p.name.toLowerCase().includes(this.searchTerm));
                    if (items.length > 0) {
                        container.innerHTML += `<div class="cat-title">${cat}</div><div class="product-grid">${items.map(p => this.createCard(p)).join('')}</div>`;
                    }
                });
            },

            createCard: function(p) {
                const qty = this.cart[p.name]?.qty || 0;
                return `
                <div class="product-card ${qty > 0 ? 'in-cart' : ''}">
                    <div onclick="app.updateQty('${p.name}', 1)">
                        <span class="prod-icon">${p.icon}</span>
                        <span class="prod-name">${p.name}</span>
                    </div>
                    <div class="controls">
                        <button class="btn-ctrl" onclick="app.updateQty('${p.name}', -1)">-</button>
                        <span>${qty || ''}</span>
                        <button class="btn-ctrl btn-plus" onclick="app.updateQty('${p.name}', 1)">+</button>
                    </div>
                </div>`;
            },

            renderShop: function() {
                const container = document.getElementById('shopping-list-container');
                // Erh√§lt exakt die Reihenfolge des CATALOG Arrays
                const items = CATALOG.filter(p => this.cart[p.name]).map(p => ({...p, ...this.cart[p.name]}));
                
                if (items.length === 0) { container.innerHTML = "<p style='text-align:center; color:#888; margin-top:30px;'>Deine Einkaufsliste ist leer.</p>"; return; }
                
                container.innerHTML = items.map(item => `
                    <div class="shopping-list-item ${item.checked ? 'checked' : ''}">
                        <div class="item-left" onclick="app.toggleCheck('${item.name}')">
                            <input type="checkbox" class="checkbox-custom" ${item.checked ? 'checked' : ''} onclick="event.stopPropagation(); app.toggleCheck('${item.name}')">
                            <span style="font-size:1.5rem; margin-left:8px;">${item.icon}</span>
                            <div class="item-details">
                                <span class="item-name-row">${item.name}</span>
                                <span class="item-info-row">${item.category} ‚Ä¢ Seite: ${item.side}</span>
                            </div>
                        </div>
                        <div class="item-qty-badge" onclick="app.updateQty('${item.name}', 1)">${item.qty}</div>
                    </div>
                `).join('');
                this.currentItems = items;
            },

            exportPDF: function() {
                if(!this.currentItems || this.currentItems.length === 0) {
                    alert("Die Liste ist leer!"); return;
                }
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                doc.setFontSize(20);
                doc.text("Einkaufsliste", 10, 15);
                
                doc.setFontSize(12);
                let y = 30;
                this.currentItems.forEach((item, i) => {
                    if (y > 280) { doc.addPage(); y = 20; }
                    doc.text(`[ ]  ${item.qty}x ${item.name} (${item.side})`, 10, y);
                    y += 10;
                });
                doc.save("Einkauf.pdf");
            }
        };

        app.init();
    </script>
</body>
</html>
