<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Einkaufsliste</title>

<style>
body {
  font-family: system-ui, sans-serif;
  margin: 0;
  padding: 1rem;
  background: #f5f5f5;
}

h1 { text-align: center; }

section {
  background: white;
  padding: 1rem;
  border-radius: 14px;
  margin-bottom: 1rem;
}

button {
  border: none;
  border-radius: 10px;
  padding: 0.45rem 0.6rem;
  font-size: 14px;
}

.primary { background:#007bff; color:white; }
.secondary { background:#777; color:white; }
.danger { background:#c62828; color:white; }

.small {
  font-size: 12px;
  padding: 0.35rem 0.5rem;
}

input {
  width: 100%;
  padding: 0.6rem;
  margin-bottom: 0.5rem;
}

/* ===== GRID ===== */
#list {
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  gap: 0.4rem;
}

.item {
  position: relative;
  padding: 0.4rem;
  border-radius: 10px;
  font-size: 12px;
  text-align: center;
  background: #ddd;
  cursor: pointer;
  user-select: none;
}

.item.active { font-weight: 600; }

.amount {
  display: block;
  font-size: 13px;
  margin-top: 2px;
}

/* Delete */
.delete {
  position: absolute;
  top: 2px;
  right: 4px;
  font-size: 11px;
  opacity: 0.6;
}

/* Drag */
.edit-mode .item {
  cursor: grab;
  outline: 2px dashed rgba(0,0,0,0.15);
}

/* ===== SHOPPING ===== */
#shoppingList {
  margin-top: 0.5rem;
}

#shoppingList .shop-item {
  padding: 0.25rem 0;
  font-size: 16px;
  border-bottom: 1px solid #eee;
}

.done {
  text-decoration: line-through;
  opacity: 0.4;
}

/* ===== MODAL ===== */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.4);
  display: none;
  align-items: center;
  justify-content: center;
}

.modal-content {
  background: white;
  padding: 1rem;
  border-radius: 14px;
  width: 90%;
  max-width: 320px;
}

.category-btn {
  width: 100%;
  margin-bottom: 0.5rem;
  border-radius: 10px;
}
</style>
</head>

<body>

<h1>üõí Einkaufsliste</h1>

<section>
  <input id="nameInput" placeholder="Produkt eingeben">
  <button class="primary" onclick="openCategoryModal()">Hinzuf√ºgen</button>
</section>

<section>
  <h3>Meine Liste</h3>
  <button class="secondary small" onclick="toggleEditMode()">‚Üï Reihenfolge bearbeiten</button>
  <div id="list"></div>
  <div style="margin-top:0.8rem">
    <button class="primary" onclick="startShopping()">Einkaufen gehen</button>
  </div>
</section>

<section id="shoppingSection" style="display:none">
  <h3>üß≠ Einkaufsmodus</h3>
  <div id="shoppingList"></div>
  <button class="danger" onclick="finishShopping()">Fertig</button>
</section>

<!-- CATEGORY MODAL -->
<div class="modal" id="categoryModal">
  <div class="modal-content">
    <h3>Kategorie w√§hlen</h3>
    <div id="categoryButtons"></div>
    <button class="secondary" onclick="closeCategoryModal()">Abbrechen</button>
  </div>
</div>

<script>
const categoryOrder = [
  "Obst & Gem√ºse",
  "Backwaren",
  "Fleisch",
  "K√ºhlregal",
  "Tiefk√ºhl",
  "Haushalt"
];

const categories = {
  "Obst & Gem√ºse": "#b7e4c7",
  "Backwaren": "#ffe066",
  "Fleisch": "#f4a261",
  "K√ºhlregal": "#a5d8ff",
  "Tiefk√ºhl": "#dee2ff",
  "Haushalt": "#e9ecef"
};

let items = JSON.parse(localStorage.getItem("items")) || [];
let pendingName = "";
let editMode = false;
let dragIndex = null;

function save(){ localStorage.setItem("items", JSON.stringify(items)); }

/* ===== ADD ===== */
function openCategoryModal() {
  if (!nameInput.value.trim()) return;
  pendingName = nameInput.value.trim();
  categoryButtons.innerHTML = "";

  Object.entries(categories).forEach(([cat,color])=>{
    const b=document.createElement("button");
    b.className="category-btn";
    b.style.background=color;
    b.textContent=cat;
    b.onclick=()=>addItem(cat);
    categoryButtons.appendChild(b);
  });
  categoryModal.style.display="flex";
}

function closeCategoryModal(){
  categoryModal.style.display="none";
  pendingName="";
}

function getNextOrder(category){
  return Math.max(0,...items.filter(i=>i.category===category).map(i=>i.order||0))+1;
}

function addItem(category){
  let ex=items.find(i=>i.name.toLowerCase()===pendingName.toLowerCase());
  if(ex){ ex.amount=(ex.amount+1)%6; }
  else{
    items.push({
      name: pendingName,
      category,
      order: getNextOrder(category),
      amount:1
    });
  }
  nameInput.value="";
  closeCategoryModal();
  save(); render();
}

/* ===== LIST ===== */
function changeAmount(index){
  items[index].amount = (items[index].amount + 1) % 6;
  save(); render();
}

function removeItem(index){
  items.splice(index,1);
  save(); render();
}

function toggleEditMode(){
  editMode=!editMode;
  document.body.classList.toggle("edit-mode",editMode);
}

function renumberCategory(category){
  items
    .filter(i=>i.category===category)
    .sort((a,b)=>a.order-b.order)
    .forEach((i,idx)=>i.order=idx+1);
}

function render(){
  list.innerHTML="";

  const sorted = [...items].sort((a,b)=>{
    return categoryOrder.indexOf(a.category)-categoryOrder.indexOf(b.category)
      || (a.order??999)-(b.order??999);
  });

  sorted.forEach(item=>{
    const index = items.indexOf(item);
    const d=document.createElement("div");
    d.className="item"+(item.amount>0?" active":"");
    d.style.background=item.amount>0?categories[item.category]:"#ddd";
    d.draggable=editMode;

    d.innerHTML=`
      <span class="delete" onclick="event.stopPropagation();removeItem(${index})">üóëÔ∏è</span>
      ${item.name}
      <span class="amount">${item.amount||""}</span>
    `;

    d.onclick=()=>!editMode&&changeAmount(index);

    d.ondragstart=()=>dragIndex=index;
    d.ondragover=e=>editMode&&e.preventDefault();
    d.ondrop=()=>{
      if(!editMode) return;
      const a=items[dragIndex];
      const b=item;
      if(a.category!==b.category) return;
      [a.order,b.order]=[b.order,a.order];
      renumberCategory(a.category);
      save(); render();
    };

    list.appendChild(d);
  });
}

/* ===== SHOPPING ===== */
function startShopping(){
  shoppingSection.style.display="block";
  shoppingList.innerHTML="";

  items.filter(i=>i.amount>0)
    .sort((a,b)=>{
      return categoryOrder.indexOf(a.category)-categoryOrder.indexOf(b.category)
        || (a.order??999)-(b.order??999);
    })
    .forEach(i=>{
      const d=document.createElement("div");
      d.className="shop-item";
      d.innerHTML=`
        <label>
          <input type="checkbox" onchange="this.parentElement.parentElement.classList.toggle('done')">
          ${i.name} (${i.amount})
        </label>`;
      shoppingList.appendChild(d);
    });
}

function finishShopping(){
  shoppingSection.style.display="none";
  items.forEach(i=>i.amount=0);
  save(); render();
}

render();
</script>

</body>
</html>
